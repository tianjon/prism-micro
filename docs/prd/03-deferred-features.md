# 被推迟的功能及理由

> 本文档记录了在 R4 终审投票及 R5 Delta 评审中未进入 Must Have 的所有功能条目，包括 7 项 Won't Have 和 5 项 Should Have。每项功能均包含推迟原因（引用具体讨论记录）、建议纳入阶段、纳入条件和依赖关系分析。
>
> **投票记录**：详见 `01-discussion-records/R4-final-voting.md`
> **R5 评审记录**：详见 `01-discussion-records/R5-delta-review.md`
> **最终 PRD**：详见 `02-prd-phase1.md`（v2.0，经 R5 Delta 评审修订）

---

## 概览

| # | 功能 | R4 加权分 | 分级 | 建议纳入阶段 | 工时估算 |
|---|------|----------|------|-------------|---------|
| W1 | Stage 4 关系构建 | 2.57 | Won't Have | Phase 3 后续 | 10-15 人天 |
| W2 | 完整 Signal→Concept 治理工作台 | 2.81 | Won't Have | Phase 4 | 15-20 人天 |
| W3 | Agent 对话界面（SSE 流式） | 2.43 | Won't Have | Phase 5 | 12-18 人天 |
| W4 | 数据可视化图表（趋势线、热力图） | 2.53 | Won't Have | Phase 4+ | 8-12 人天 |
| W5 | 可配置周期性采集（dev-browser 通用框架） | — (R5 新增) | Won't Have | Phase 2 | 15-25 人天 |
| W6 | Neo4j 知识图谱功能 | — (R5 新增) | Won't Have | Phase 2 | 10-15 人天 |
| W7 | 水平扩展部署（L4 弹性） | — (R5 新增) | Won't Have | Phase 4+ | 15-25 人天 |
| S1 | 前端第二批（详情页 + 精细交互） | 3.37 | Should Have | Phase 3 后冲刺 | 10 人天 |
| S2 | Agent 精简版还债（SkillRegistry 迁移 DB + Loop 配置化） | 3.24 | Should Have | Phase 3 后强制 | 8-13 人天 |
| S3 | 行为追踪埋点 | 3.16 | Should Have | Phase 3 内（如有余量） | 1 人天 |
| S4 | Agent 行为评估基准 | 3.14 | Should Have | Phase 3 交付前 | 3-5 人天 |
| S5 | Redis 缓存失效降级（L3 弹性） | — (R5 新增) | Should Have | Phase 1 余量 / Phase 2 初期 | 1 人天 |

---

## Won't Have（R4 加权分 < 3.0）

### W1：Stage 4 关系构建

**R4 加权分**：2.57（所有条目中排名第 17/20）

#### 功能描述

AI 管线的第四阶段——在 SemanticUnit 之间建立显式的语义关系网络。通过 LLM 分析 SemanticUnit 对之间的关系类型（因果、并发、矛盾、补充等），构建知识图谱雏形，为后续的洞察引擎提供结构化的关系数据。

#### 推迟原因

**1. R1 辩论 b 的明确共识：Stage 4 不进入 MVP。**

在 R1 辩论 b（MVP 功能范围）中，正方（苏明远 + 陈思琪）与反方（赵一凡 + 周安）在 5:0:2 的压倒性投票中达成共识：MVP 只包含 Stage 1-3，Stage 4 作为 Won't Have 推迟。R2 共识清单第 17 条明确记录："Stage 4 关系构建——Won't Have，推迟到 Phase 3 后续完善。"

**2. R4 投票中几乎所有非 AI 专家给出低分。**

R4 评分详情显示，只有陈思琪给出高分（战略意义 5 分，技术可行性 4 分）——她视关系构建为 AI 管线完整性的关键。但其他 6 位专家在用户价值维度上的平均分仅为 2.14（7 人中有 3 人给出 1-2 分），反映了一个核心共识：**在 Stage 1-3 尚未经过真实数据验证之前，Stage 4 是过早的优化**。

**3. 技术可行性存疑（R4 平均 2.71）。**

赵一凡在 R4 中给技术可行性 3 分，指出关系构建依赖充足的 SemanticUnit 对（至少数千对）才能产出有意义的关系图谱。Phase 3 的初始数据量（1000-3000 条 Voice，预计产出 2000-6000 个 SemanticUnit）可能不足以支撑高质量的关系分析。

#### 建议纳入阶段

**Phase 3 后续完善**（路线图 Phase 3 扩展期，预计 M5 验收后 4-8 周内）

#### 纳入条件

1. **数据量门槛**：系统中已积累 >= 5000 个 SemanticUnit，且涌现标签数量 >= 50 个（确保关系构建有足够的语义多样性）
2. **Stage 1-3 质量达标**：AI 管线处理可靠性 > 95%、标注一致性 > 70%（Phase 3 验收标准已通过）
3. **标签标准化成熟度**：同义标签合并覆盖率 > 50%（避免关系构建在低质量标签上浪费 LLM Token）
4. **团队产能释放**：Phase 3 核心交付完成，Agent 还债（S2）已启动或完成

#### 依赖关系

```
Stage 4 关系构建
├── 硬依赖
│   ├── Stage 1-3 已上线且稳定运行
│   ├── pgvector 索引在万级向量规模下性能验证通过
│   └── LLM Chat API 稳定（关系分析需大量 LLM 调用）
├── 软依赖
│   ├── 标签标准化表已积累足够条目
│   └── 涌现标签质量经 dogfooding 反馈验证
└── 被依赖方
    ├── Phase 4 洞察引擎（关系图谱是洞察引擎的输入之一）
    └── Phase 6 知识网络可视化
```

---

### W2：完整 Signal→Concept 治理工作台

**R4 加权分**：2.81（Won't Have 中得分最高）

#### 功能描述

实现 VP2（Signal→Concept 两阶段知识沉淀）的完整治理界面。包含五个并行分析器（趋势分析器、聚类分析器、异常检测器、情感漂移检测器、关联分析器）自动产生 Signal，以及人类将 Signal 确认为 Concept 的治理操作（确认 / 拒绝 / 合并 / 拆分 / 归档）和完整的审计轨迹。

#### 推迟原因

**1. R1 辩论 g 的妥协：完整治理推迟到 Phase 4，Phase 3 只做最小反馈机制。**

方若琳在 R1 辩论 g 中原始提案包含三个组件：确认/拒绝按钮 + 统计仪表板 + 拒绝标签过滤器。经王磊的务实反对（"4.5 人团队，先出产品再补机制"）和多轮交锋后，方若琳让步为最小版本——一个 thumbs-up/down/error 按钮 + `tag_feedback` 表。R2 共识清单第 18 条明确记录："完整 Signal→Concept 治理工作台——Won't Have，推迟到 Phase 4。"

**2. 治理对象尚不存在（R4 中赵一凡的关键论点）。**

R4 评分中赵一凡在用户价值维度仅给 2 分，他的理由直指核心矛盾：治理工作台需要五个并行分析器自动产出 Signal，而这些分析器是 Phase 4 的交付物。在 Phase 3 阶段，"Signal"这个概念在系统中尚不存在——用户只有涌现标签和语义搜索结果。**治理一个尚不存在的对象，是经典的"提前建造"反模式。**

**3. R4 投票中工程实现派普遍低分。**

王磊在三个维度给出 1 分（用户价值、技术可行性、组织可采纳性），这是所有条目中他给出的最低评分组合。他的立场在 R1 辩论 g 中已充分表达："4.5 人团队做不了这么复杂的功能。"赵一凡在技术可行性上也仅给 2 分，认为完整治理工作台的工程复杂度远超 Phase 3 的承受范围。

**4. 方若琳的"孤独高分"。**

方若琳在用户价值（5）、战略意义（5）、组织可采纳性（5）上给出满分，但她是唯一在这些维度给出 4 分以上的专家。这反映了一个结构性事实：治理工作台是方若琳最核心的关切（VP2 的完整实现），但在当前团队规模和时间约束下，她的愿景与工程现实之间存在显著落差。方若琳自己在 R2 中也接受了这一妥协。

#### 建议纳入阶段

**Phase 4**（路线图中的"语义治理 + 多维分析"阶段）

#### 纳入条件

1. **五个并行分析器中至少 3 个已实现**：Signal 的自动产出是治理工作台的前提
2. **涌现标签经过至少 4 周的 dogfooding 验证**：标签质量和用户反馈数据为治理策略提供输入
3. **团队扩展到 5+ 人**：治理工作台涉及后端 API + 前端交互 + 审计逻辑，需要并行开发能力
4. **Phase 3 的最小反馈机制已积累 >= 200 条反馈**：证明用户有治理意愿，治理工作台不是"建了没人用"

#### 依赖关系

```
完整 Signal→Concept 治理工作台
├── 硬依赖
│   ├── Phase 4 并行分析器（至少趋势分析器 + 聚类分析器）
│   ├── Phase 3 EmergentTag 数据模型中的预留字段
│   │   ├── status: Enum (active/merged/deprecated)
│   │   ├── confidence: Float
│   │   └── parent_tag_id: UUID (nullable, FK → self)（方若琳在 R3 交叉审查中建议预留）
│   └── Phase 3 最小反馈机制（tag_feedback 表结构）
├── 软依赖
│   ├── Stage 4 关系构建（W1）——关系数据丰富治理决策的上下文
│   └── 行为追踪埋点（S3）——用户行为数据辅助治理优先级排序
└── 被依赖方
    ├── Phase 5 高级 Agent 能力（Agent 需要基于 Concept 做决策）
    └── Phase 6 知识进化引擎
```

---

### W3：Agent 对话界面（SSE 流式）

**R4 加权分**：2.43（所有条目中排名最低）

#### 功能描述

为 Agent 交互提供实时流式对话界面，使用 Server-Sent Events（SSE）协议实现打字机效果的实时响应。用户可以通过自然语言与 Agent 交互，Agent 实时展示思考过程、工具调用和结果输出。

#### 推迟原因

**1. R2 共识清单明确归入 Phase 5 范畴。**

R2 共识清单第 19 条直接标注"Won't Have——Phase 5 范畴"。这一判定基于 R1 辩论 e（前端投入）中的核心共识：Phase 3 的前端资源聚焦在数据页面（导入页 + 搜索页 + 标签列表页），不分散到对话界面。

**2. R1 辩论 c 的渐进式 Agent 策略排除了对话界面的必要性。**

R1 辩论 c（Agent-First 时序）的投票结果为 1:4:2（反方胜），确立了"渐进式 Agent"策略。Phase 2.5 精简版只需要 API 端点（`/api/agent/execute`），不需要专门的对话 UI。Agent 的交互在 Phase 3 内完全通过 CLI（`apps/cli/`）满足——CLI 是 AI Agent 的天然界面（R1 辩论 c 中王磊的核心论点）。

**3. R4 投票中技术派和安全派一致否定。**

赵一凡（技术可行性 2 分）、王磊（用户价值 1 分、战略意义 1 分）、周安（用户价值 1 分、风险可控性 2 分）三位给出了极低评分。周安的反对尤其值得关注：SSE 流式对话引入了新的安全攻击面（prompt injection 可通过实时界面更容易触发），且在 Phase 3 没有足够的安全基础设施来应对。

**4. 前端复杂度远超 Phase 3 承受范围。**

SSE 流式对话界面涉及：WebSocket/SSE 连接管理、实时 Token 渲染、思考过程可视化、工具调用状态展示、连接重试和断线恢复。仅前端部分估计就需要 8-12 人天——超过了 Phase 3 前端第一批（10 人天）的全部预算。

#### 建议纳入阶段

**Phase 5**（路线图中的"高级 Agent 能力"阶段）

#### 纳入条件

1. **Agent Loop 已从精简版升级为配置化版本**：SkillRegistry 迁移 DB + Loop 配置化（S2 Agent 还债）必须先完成
2. **Agent 行为评估基准（S4）已建立**：确保 Agent 交互质量达到对话界面的展示标准
3. **前端团队产能 >= 1.5 人**：对话界面需要专职前端持续投入
4. **安全基础设施就位**：Prompt injection 防护、Token 限速、实时流的审计日志
5. **Phase 4 的 Agent 编排能力已上线**：对话界面需要展示多步骤编排过程，单一 ReAct 循环不足以支撑有意义的对话体验

#### 依赖关系

```
Agent 对话界面（SSE 流式）
├── 硬依赖
│   ├── Agent 还债（S2）——配置化 Loop 是对话界面的后端基础
│   ├── Phase 4 Agent 编排能力——多步骤编排才值得对话展示
│   └── LLM Streaming API 稳定——llm-service 的 Chat API 需支持流式输出
├── 软依赖
│   ├── Agent 行为评估基准（S4）——确保对话质量
│   ├── 前端第二批（S1）——UI 组件库和交互模式的积累
│   └── Phase 4 安全增强——Prompt injection 防护
└── 被依赖方
    ├── Phase 6 自然语言分析入口
    └── 外部用户自助分析场景
```

---

### W4：数据可视化图表（趋势线、热力图）

**R4 加权分**：2.53

#### 功能描述

为涌现标签和语义分析结果提供图表化展示，包括：标签频率趋势线（时间维度）、标签关联热力图（语义相似度矩阵）、情感分布饼图/柱状图、数据导入量变化曲线等。

#### 推迟原因

**1. 数据规模不足以支撑有意义的可视化。**

R4 投票中赵一凡在技术可行性和战略意义上均给 2 分，理由直接：Phase 3 预期数据量为 1000-3000 条 Voice、2000-6000 个 SemanticUnit、50-200 个涌现标签。这个数据规模下的趋势线只有零星几个数据点，热力图的矩阵维度太小——**可视化出来的效果可能比 Excel 表格还差**。数据可视化的价值与数据积累量成正比，在小数据量阶段是负 ROI。

**2. R1 辩论 e 中的前端优先级排序。**

R1 辩论 e（前端投入）中，王磊提出"两批交付"方案，第一批聚焦数据操作页面（导入 + 搜索 + 标签列表），第二批聚焦详情和精细交互。数据可视化图表不在这两批中的任何一批——它是第三层次需求。苏明远在辩论中接受了从 4 页面缩减为 3 页面的方案，可视化图表在这次缩减中被明确排除。

**3. R4 投票中几乎所有技术角色给出最低分。**

赵一凡（2 分 x 4 维度）、陈思琪（2 分 x 3 维度）、王磊（1-2 分 x 4 维度）——三位技术角色的平均评分不到 2 分。王磊在用户价值上给出 1 分，他的理由是："在标签和搜索的基础 API 之上做可视化是 Phase 4+ 的增量需求，Phase 3 应该让数据先流动起来。"

#### 建议纳入阶段

**Phase 4+**（Phase 4 后期或 Phase 5 初期，取决于数据积累速度）

#### 纳入条件

1. **数据量达到统计意义门槛**：系统中积累 >= 10000 条 Voice、>= 500 个涌现标签（趋势线至少需要 30+ 个时间点的数据才有意义）
2. **前端第二批（S1）已完成**：可视化图表的技术基础（图表库集成、响应式布局）在第二批中建立
3. **用户明确表达可视化需求**：dogfooding 或外部用户反馈中有"需要图表"的明确信号（避免"建了没人看"）
4. **Stage 4 关系构建（W1）已上线**：热力图的核心数据来源是 SemanticUnit 之间的关系数据

#### 依赖关系

```
数据可视化图表
├── 硬依赖
│   ├── 前端第二批（S1）——图表库集成和 UI 框架
│   ├── 足量数据积累——趋势和分布需要统计基础
│   └── VOC API 稳定——图表数据来自后端聚合 API
├── 软依赖
│   ├── Stage 4 关系构建（W1）——热力图的关系数据
│   ├── Phase 4 并行分析器——趋势数据来自时序分析器
│   └── 行为追踪埋点（S3）——用户交互热点数据
└── 被依赖方
    ├── Phase 6 管理层仪表板
    └── 外部用户自助报表
```

---

### W5：可配置周期性采集（dev-browser 通用框架）

**来源**：用户修正 #3（R5 Delta 评审）

#### 功能描述

基于 dev-browser 等浏览器控制工具，构建一个通用的周期性数据采集框架。支持用户配置采集任务（数据源 URL、采集频率、关键词过滤），系统按配置自动执行爬虫并将数据导入 VOC 管线。与 Phase 1 的独立脚本 + CLI 手动触发不同，这是一个完整的自动化采集调度系统，涵盖任务配置、定时调度、状态监控等全链路能力。

#### 推迟原因

**1. R5-A 辩论 A2 的压倒性共识：Phase 1 爬虫作为独立脚本 + CLI 触发。**

R5-A 辩论 A2（爬虫与 Agent/Skill 引擎的耦合度）投票结果为 7:0——全员一致认为 Phase 1 爬虫应作为独立 Python 脚本 + CLI 手动触发，不与 Agent/Skill 引擎做深度耦合。这一共识直接将通用采集框架排除在 Phase 1 之外。

**2. 赵一凡条件：Phase 1 独立模块，Phase 2 才做集成。**

赵一凡在 R5-A 辩论中明确设定条件：Phase 1 爬虫必须是独立模块，Phase 2 才做 Agent/Skill 集成。这构成了一个显式的阶段门控——在独立脚本验证爬虫可行性之前，不应投入通用框架的建设。

**3. 通用采集框架的工程复杂度远超 Phase 1 可承受范围。**

构建完整的周期性采集框架需要以下组件：
- dev-browser 环境的容器化（Chromium 运行时管理）
- 定时调度器（cron-like 或 Agent 定时触发机制）
- 采集任务配置 UI（数据源管理界面）
- 采集状态监控（任务执行日志、失败重试、告警）

这些组件的总工时预估 15-25 人天，远超 Phase 1 的产能预算。Phase 1 聚焦懂车帝/微博两个固定数据源的爬虫验证（F22/F23），不需要通用框架的灵活性。

#### 建议纳入阶段

**Phase 2**（爬虫验证通过后的自然扩展）

#### 纳入条件

1. **Phase 1 的懂车帝/微博爬虫（F22/F23）已验证可行**：独立脚本成功运行且数据质量达标
2. **Agent/Skill 引擎已从精简版升级**：S2 Agent 还债完成，Skill 调度能力支持定时触发
3. **爬虫合规风险已被评估且可接受**：周安安全审查通过，目标站点的反爬策略和法律风险已明确
4. **至少 2 周的爬虫稳定运行记录**：证明爬虫脚本在目标站点上的长期可靠性

#### 依赖关系

```
可配置周期性采集（dev-browser 通用框架）
├── 硬依赖
│   ├── Phase 1 爬虫独立脚本（F22/F23）——验证爬虫技术可行性
│   ├── Agent 还债（S2）——Skill 调度能力支持定时触发
│   └── dev-browser 容器化方案——Chromium 运行时环境
├── 软依赖
│   └── 增量去重引擎（F24，Phase 1 已有基础版）——周期性采集需要成熟的去重能力
└── 被依赖方
    ├── Phase 3+ 多渠道自动采集——更多数据源接入
    └── 外部用户自助配置采集源——开放采集能力给终端用户
```

---

### W6：Neo4j 知识图谱功能

**来源**：用户修正 #6 + R5-C 辩论 C1 决议

#### 功能描述

利用 Neo4j 图数据库构建 VOC 数据的知识图谱。包括：标签之间的语义关系网络（因果、并发、矛盾、补充）、跨数据源的实体关联、基于 Cypher 的图查询 API。这是 Stage 4 关系构建（W1）的基础设施载体——W1 定义了关系构建的逻辑层，W6 提供图数据库层面的存储和查询能力。

#### 推迟原因

**1. R5-C 辩论 C1 明确限定：Phase 1 只建立最小连接层。**

R5-C 辩论 C1（Neo4j 在 Phase 1 的定位）投票结果为 3:2:1:1（折中方案胜出），确立了"Phase 1 只建立最小连接层"的策略。最小连接层（F25）仅包含 Neo4j 容器启动 + 基础连接验证 + 一个简单的写入/读取 API，不涉及完整的图谱建模和查询能力。

**2. 方若琳的关键警告：避免低优先级功能的基础设施偷偷提升优先级。**

方若琳在 R5-C 辩论中明确指出："不要让一个低优先级功能的基础设施准备工作偷偷拉高它的实际优先级。"这一警告直指 Neo4j 的风险——如果 Phase 1 投入过多精力在图数据库基础设施上，实质上是在为一个 R4 加权分仅 2.57（W1 Stage 4）的功能做提前投资，违背了优先级排序的初衷。

**3. R4 投票中 Stage 4 加权分仅 2.57，倒数第四。**

Neo4j 知识图谱是 Stage 4 关系构建的基础设施载体。Stage 4 本身在 R4 投票中排名倒数第四（2.57 分），这意味着其基础设施的优先级不应高于功能本身。在 Stage 1-3 尚未经过真实数据验证之前，投入完整图谱能力是典型的"过早优化"。

**4. Phase 1 数据量不足以支撑有意义的图查询。**

Phase 1 预期处理的 VOC 数据量有限。在数据量不足以形成有意义的语义关系网络之前，图查询的返回结果将极为稀疏，无法体现 Neo4j 相对于关系型数据库的优势。Cypher 查询的价值与图的密度和规模成正比。

#### 建议纳入阶段

**Phase 2**（与 W1 Stage 4 关系构建同步推进）

#### 纳入条件

1. **系统中已积累 >= 5000 个 SemanticUnit**：图谱需要足够的节点密度才有意义
2. **Stage 1-3 AI 管线稳定运行**：处理可靠性 > 95%，确保图谱的输入数据质量
3. **Phase 1 Neo4j 最小连接层（F25）验证通过**：容器化部署稳定、基础读写性能达标
4. **团队有 Neo4j / Cypher 开发经验或已完成学习**：图数据库开发有显著的学习曲线

#### 依赖关系

```
Neo4j 知识图谱功能
├── 硬依赖
│   ├── Stage 4 关系构建（W1）——图谱是关系构建的存储载体
│   ├── Neo4j 最小连接层（F25）——Phase 1 基础设施验证
│   └── Stage 1-3 稳定运行——图谱输入数据的质量保障
├── 软依赖
│   ├── 标签标准化成熟度——标签作为图节点的质量直接影响图谱价值
│   └── 涌现标签质量验证——低质量标签产生低质量关系边
└── 被依赖方
    ├── Phase 4 洞察引擎——图查询是洞察生成的核心能力
    └── 知识网络可视化——图谱的前端展示层
```

---

### W7：水平扩展部署（L4 弹性）

**来源**：R5-C 辩论 C2 弹性策略分层

#### 功能描述

将 Prism 从单机 Docker Compose 部署升级为支持水平扩展的容器编排部署。包括：Kubernetes 集群配置、服务自动伸缩（HPA）、负载均衡、分布式会话管理（Redis Cluster）、数据库连接池集群化、健康检查和自动恢复。这是弹性策略分层中 L4（水平扩展弹性）的完整实现。

#### 推迟原因

**1. R5-C 辩论 C2 弹性策略分层：L4 定位为 Won't Have。**

赵一凡在 R5-C 辩论 C2（弹性策略）中提出 L0-L4 五层弹性分层方案，全员 7:0 通过。L4（水平扩展）被明确定位为 Won't Have，推迟到 Phase 4+。核心理由是 Phase 1 为单机部署场景，用户量极小（内部 dogfooding + 少量外部用户），水平扩展在此阶段无实际意义。

**2. 王磊的务实论点：单机 Docker Compose 足以支撑 Phase 1-2 的全部负载。**

Phase 1 预期用户量不超过 10 人（内部团队 + 少量外部演示用户），数据量不超过万级 Voice。单机部署（16GB RAM + 4 核 CPU）完全可以支撑这一规模的读写负载。在用户量和数据量达到单机瓶颈之前，投入 Kubernetes 编排是典型的过早优化。

**3. 工程复杂度与团队规模不匹配。**

Kubernetes 部署涉及大量运维知识（网络策略、存储卷管理、密钥管理、CI/CD 流水线适配），预估需要 15-25 人天。在 4.5 人团队中，这几乎等于一个完整迭代的产能——投入到基础设施而非产品功能上，违背了 Phase 1 "到达用户可感知价值"的核心目标。

#### 建议纳入阶段

**Phase 4+**（用户量和数据量达到单机瓶颈时）

#### 纳入条件

1. **单机性能瓶颈确认**：监控数据显示 CPU/内存利用率持续 > 70%，或 API P95 延迟超过 SLA 承诺
2. **用户量增长到需要高可用**：外部用户 > 50 人，需要 SLA 保障（如 99.9% 可用性）
3. **团队具备 Kubernetes 运维能力**：至少 1 名工程师有 K8s 生产环境运维经验
4. **L0-L3 弹性策略全部就位**：水平扩展是弹性策略的最高层，低层级策略应先完善
5. **CI/CD 流水线成熟**：自动化测试、容器镜像构建、滚动部署等基础设施已建立

#### 依赖关系

```
水平扩展部署（L4 弹性）
├── 硬依赖
│   ├── L0-L3 弹性策略已全部上线
│   ├── Docker Compose 部署稳定运行
│   └── 各服务的 health check 端点完善
├── 软依赖
│   ├── Redis Cluster 方案选型——分布式会话管理
│   ├── PostgreSQL 读写分离或连接池优化——数据库层扩展
│   └── CI/CD 自动化流水线——支持多环境部署
└── 被依赖方
    ├── 生产环境 SLA 承诺——高可用是 SLA 的基础
    └── 多租户部署——每个租户可能需要独立的资源配额
```

---

## Should Have（R4 加权分 3.0 - 3.5）

### S1：前端第二批（详情页 + 置信度精细交互 + 审核列表）

**R4 加权分**：3.37

#### 功能描述

在前端第一批（数据导入页 + 搜索页 + 标签列表页）基础上的增量交付，包括：反馈详情页（点击标签后的深度展开视图）、置信度精细交互（滑动过滤不同置信度层级的标签）、审核列表（按时间排列的待审核标签队列）、搜索增强（搜索历史、推荐查询）。

#### 推迟原因

**1. R1 辩论 e 中王磊的"两批交付"方案。**

王磊在 R1 辩论 e 中提出的核心策略："第一批 Phase 3 内 3 页面（Must Have），第二批 Phase 3 后专项冲刺（Should Have）。"这一方案获得 5:1:1 投票通过，是团队关于前端投入的核心共识。第二批被定位为"从能用到好用"的升级——Phase 3 的目标是"能用"就够了。

**2. R4 投票中技术派评分偏低。**

赵一凡在用户价值（2 分）和战略意义（3 分）上给出低分，反映其"API First"的一贯立场。王磊在用户价值（2 分）和战略意义（2 分）上也给出低分，他的理由是："Phase 3 的前端资源全部投入到三个核心页面的质量保障上，不分散到更多页面。"

**3. 对 Phase 3 工期的保护。**

第二批预估 10 人天，如果纳入 Phase 3 Must Have，总前端工时从 10 人天增加到 20 人天，前端开发周期从 3 周延长到 6 周，直接冲击 M5（Phase 3 前端 + 集成）里程碑。R2 共识中的工期缓冲（Must Have 63 人天 / 90+ 人天产能）不足以吸收额外的 10 人天。

#### 建议纳入阶段

**Phase 3 后专项冲刺**（M6 Dogfooding 启动后 2-3 周内，与 dogfooding 并行）

#### 纳入条件

1. **Phase 3 前端第一批验收通过**：三个核心页面可演示、端到端流程通畅
2. **M5 里程碑按时达成**：不存在前端工期延误
3. **dogfooding 反馈确认 UI 痛点**：内部用户明确反馈"详情页不够""搜索不够好用"等具体痛点
4. **前端工程师产能空出**：M5 联调结束后前端无其他阻塞任务

#### 依赖关系

```
前端第二批
├── 硬依赖
│   ├── 前端第一批（Must Have）——页面框架和组件库
│   ├── VOC API 全部就位——详情页需要 units/{id}、voices/{id} 等 API
│   └── 反馈机制 API（Must Have F14）——审核列表依赖 tag_feedback 数据
├── 软依赖
│   ├── dogfooding 反馈数据——确认改进方向
│   └── 行为追踪埋点（S3）——量化用户交互痛点
└── 被依赖方
    ├── 数据可视化图表（W4）——图表库和 UI 框架基础
    └── 外部用户版本——"好用"是对外发布的最低门槛
```

---

### S2：Agent 精简版还债（SkillRegistry 迁移 DB + Loop 配置化）

**R4 加权分**：3.24（触发否决权降级，但附强制执行条件）

#### 功能描述

将 Phase 2.5 精简版 Agent 中的 Type 2（可逆）决策升级为生产级实现：
- **SkillRegistry 迁移 DB**（5-8 人天）：从 YAML 配置文件迁移为数据库持久化，支持 CRUD API 和运行时动态注册/注销 Skill
- **Agent Loop 配置化**（3-5 人天）：将硬编码的 `max_iterations=10` 和 Token 计数器升级为可配置参数，支持不同任务类型的差异化配置

#### 推迟原因

**1. R1 辩论 c 中的"先简后补"核心共识。**

R1 辩论 c 的投票结果为 1:4:2（渐进式 Agent 胜出），核心共识是"Type 1 决策做对，Type 2 决策先简后补"。Agent 还债是这个共识的直接产物——精简版的 YAML SkillRegistry 和硬编码 Loop 在 Phase 3 内够用，完整版推迟到 Phase 3 后。

**2. R4 投票中用户价值维度触发否决权。**

苏明远（1 分）、林晓薇（1 分）、方若琳（1 分）三人在用户价值维度打 1 分，触发"任一维度 3+ 人打 1 分自动降级"规则。他们的理由高度一致：**Agent 还债是纯技术内部工作，终端用户完全无感知**。加权分 3.24 原本在 Should Have 区间，降级规则进一步确认了这一定位。

**3. 但具有工程强制性（陈思琪否决权）。**

虽然 R4 评分将其定位为 Should Have，但 R2 共识中明确记录"陈思琪保留'还债期被跳过则 block Phase 4'的否决权"。这意味着 Agent 还债在工程依赖关系上是 Phase 4 的硬性前置条件——**时间上不在 Phase 3 Must Have 中，但不可跳过**。M5 验收后强制启动（约 W0+14 周前完成），陈思琪保留阻止 Phase 4 启动的否决权。

#### 建议纳入阶段

**Phase 3 后 2 周内强制执行**（M5 验收后，约 W0+14 周前完成）

#### 纳入条件

1. **Phase 3 核心交付（M5）验收通过**：Agent 还债不与 Phase 3 Must Have 抢资源
2. **精简版 Agent 经过 Phase 3 实际使用验证**：了解 YAML SkillRegistry 和硬编码 Loop 的实际局限性，避免盲目迁移
3. **陈思琪确认迁移方案**：DB Schema 设计、数据迁移脚本、API 接口定义需 AI/ML 专家审核

#### 特别约束

**这是唯一一个带有强制执行约束的 Should Have 条目。** 如果 M8 里程碑未完成，陈思琪有权行使否决权阻止 Phase 4 启动。这一机制在 R1 辩论 c 中由陈思琪提出、在 R2 共识中获全员确认、在 R4 否决权记录中再次被确认（R4-final-voting.md 否决权记录 #2）。

#### 依赖关系

```
Agent 精简版还债
├── 硬依赖
│   ├── Phase 2.5 精简版 Agent 已上线（Must Have F7/F8/F9）
│   ├── Phase 3 核心交付完成（不与 Must Have 抢资源）
│   └── agent Schema 已就位
├── 软依赖
│   ├── Phase 3 期间 Agent 使用反馈——了解精简版局限性
│   └── Agent 行为评估基准（S4）——迁移后可用基准验证回归
└── 被依赖方（硬性阻塞）
    ├── Phase 4 全部 Agent 相关功能
    ├── Agent 对话界面（W3）
    └── Phase 5 高级 Agent 编排
```

---

### S3：行为追踪埋点（标签点击、搜索查询、停留时间）

**R4 加权分**：3.16

#### 功能描述

在前端页面中嵌入轻量级行为追踪代码，记录用户的被动行为数据：
- 标签点击事件（哪些标签被点击、频率）
- 搜索查询日志（用户输入的查询词、搜索结果点击率）
- 页面停留时间（用户在标签列表页、搜索结果页的停留时长）

数据存储到后端日志或简单的分析表中，为后续的产品改进和 VP1 假设验证提供量化依据。

#### 推迟原因

**1. R1 辩论 g 中林晓薇的"魔鬼代言人"提案。**

行为追踪埋点是林晓薇在 R1 辩论 g（治理机制）中以魔鬼代言人身份提出的补充建议："被动行为追踪（标签点击、搜索查询、页面停留时间），约 1 人天，可与主动反馈并行。"虽然获得认可，但被定位为 Should Have #4——优先级低于反馈按钮（Should Have #1）、前端第二批（Should Have #2）和对比基线验证（Should Have #3，后提升为 Must Have）。

**2. R4 投票中林晓薇"一枝独秀"。**

R4 评分显示林晓薇在所有维度给出最高分（用户价值 5、技术可行性 5、战略意义 5、组织可采纳性 5），但其他专家普遍给出 2-3 分。苏明远在战略意义上仅给 2 分，赵一凡在用户价值和组织可采纳性上给 2 分。核心原因是：**在 Phase 3 的繁忙期，1 人天的投入虽低，但会分散注意力**。

**3. 与主动反馈机制形成互补但非互替关系。**

Phase 3 的 Must Have 已包含最小反馈机制（F14），这是"主动反馈"通道。行为追踪是"被动反馈"通道，两者互补但不互替。在资源有限时，主动反馈优先——它直接回答"用户觉得标签好不好"，而被动追踪只能间接推断用户偏好。

#### 建议纳入阶段

**Phase 3 内（如有余量）或 M6 Dogfooding 启动时**

这是所有被推迟功能中投入最小（1 人天）且价值密度最高的条目。如果 Phase 3 开发节奏正常、存在 1 天空档，强烈建议提前纳入。

#### 纳入条件

1. **前端第一批核心页面上线**：埋点代码需要在真实页面中运行
2. **后端日志或分析表结构就位**：简单的 `user_event_log` 表即可
3. **至少 1 天前端/全栈工程师可用时间**

#### 依赖关系

```
行为追踪埋点
├── 硬依赖
│   ├── 前端第一批（Must Have F11/F12/F13）——需要页面载体
│   └── 后端基础日志设施——结构化日志已在非功能需求中要求
├── 软依赖
│   └── 无（极低耦合）
└── 被依赖方
    ├── 完整 Signal→Concept 治理工作台（W2）——行为数据辅助治理优先级
    ├── 数据可视化图表（W4）——用户交互热点数据
    └── Phase 4 产品分析——量化用户偏好
```

---

### S4：Agent 行为评估基准（10 个标准化测试任务）

**R4 加权分**：3.14

#### 功能描述

建立 10 个标准化的 Agent 分析任务作为评估基准，覆盖以下场景：
- 数据导入触发 AI 管线
- 语义搜索查询
- 标签质量评估
- 批量标签反馈提交
- 跨标签关联分析（简化版）
- 错误处理和降级场景

每个任务定义明确的输入、期望输出、成功标准和超时限制。Agent 通过率 > 80% 为合格基线。

#### 推迟原因

**1. R1 辩论 c 中赵一凡的"魔鬼代言人"提案。**

Agent 行为评估基准是赵一凡在 R1 辩论 c（Agent-First 时序）中以魔鬼代言人身份提出的建议："在 Phase 3 交付前建立 Agent 行为评估基准（10 个标准化分析任务，通过率 > 80%），约 3-5 人天。"该提案被纳入 R2 共识清单第 15 条，定位为 Should Have #5。

**2. R4 投票中用户感知维度得分极低。**

苏明远（用户价值 2 分、组织可采纳性 2 分）、林晓薇（用户价值 2 分、战略意义 2 分）、方若琳（用户价值 2 分、组织可采纳性 2 分）——三位非技术角色在用户价值上均给 2 分。评估基准对终端用户完全不可见，是纯粹的内部工程工具。

**3. 但赵一凡和陈思琪给出高分，反映其工程价值。**

赵一凡在技术可行性（5 分）和战略意义（5 分）上给出满分。陈思琪在战略意义上也给 5 分。他们的核心论点是：**没有评估基准，就无法区分"Agent 骨架太简"和"Prompt 写得不好"**。这对 Agent 还债（S2）的决策至关重要——如果没有基线数据，如何判断还债的优先级和范围？

#### 建议纳入阶段

**Phase 3 交付前**（M4-M5 之间，作为 Agent 质量验证的一部分）

与 S2（Agent 还债）形成配合：S4 在 Phase 3 末期建立基线，S2 在 Phase 3 后执行还债，S4 的基线数据用于验证还债后的 Agent 质量是否回归。

#### 纳入条件

1. **精简版 Agent Loop 已可运行**：评估基准需要在真实 Agent 环境中执行
2. **至少 5 个 VOC 相关 Skill 已注册**：评估任务需要覆盖真实的 Agent 能力
3. **AI 管线 Stage 1-3 已上线**：评估任务中包含触发 AI 管线的场景
4. **3-5 天 AI/后端工程师可用时间**

#### 依赖关系

```
Agent 行为评估基准
├── 硬依赖
│   ├── 精简版 Agent（Must Have F7/F8/F9）——评估对象
│   ├── VOC API（Must Have F1-F4）——评估任务的操作目标
│   └── AI 管线 Stage 1-3——评估任务覆盖的核心流程
├── 软依赖
│   └── 合成数据冷启动（Must Have F16）——评估任务需要测试数据
└── 被依赖方
    ├── Agent 还债（S2）——基线数据用于验证还债效果
    ├── Phase 4 Agent 能力扩展——持续回归测试
    └── Agent 对话界面（W3）——对话质量的量化基准
```

---

### S5：Redis 缓存失效降级（L3 弹性）

**来源**：R5-C 辩论 C2 弹性策略分层

#### 功能描述

当 Redis 不可用时，系统自动降级为 PostgreSQL 直查，确保核心功能不中断。具体实现方式为在所有 Redis 调用处统一包裹 try-except fallback 逻辑，Redis 读取失败时回退到 PostgreSQL 查询，Redis 写入失败时仅记录日志不阻塞主流程。这是弹性策略分层中 L3（缓存层弹性）的完整实现。

#### 推迟原因

**1. R5-C 辩论 C2 弹性策略分层：L3 定位为 Should Have。**

赵一凡在 R5-C 辩论 C2（弹性策略）中提出分层方案，将弹性需求分为 L0（进程级健康检查）、L1（API 超时与重试）、L2（LLM 调用降级）、L3（Redis 缓存失效降级）四个层次。L0-L2 作为 Must Have 纳入 Phase 1，L3 被定位为 Should Have——有价值但非核心阻塞。

**2. 王磊的务实论点：单机部署下 Redis 宕机直接重启。**

王磊在辩论中指出："Phase 1 单机部署，Redis 宕机直接 `docker restart`。"在单机环境下，Redis 不可用是一个极低概率事件（通常是容器崩溃或手动停止），恢复时间在秒级。构建完整的降级逻辑在这一场景下的 ROI 偏低。

**3. L0-L2 已覆盖核心弹性需求。**

Phase 1 的弹性策略以 L0-L2 为基础，已覆盖了最关键的故障场景：进程级健康检查确保容器存活、API 超时与重试确保网络瞬断恢复、LLM 调用降级确保外部 API 故障时系统不完全瘫痪。Redis 降级（L3）是锦上添花而非雪中送炭。

#### 建议纳入阶段

**Phase 1 内如有余量，或 Phase 2 初期**

这是一个低投入（1 人天）、高防御价值的功能。如果 Phase 1 开发节奏正常且存在 0.5-1 天空档，建议提前纳入。

#### 纳入条件

1. **Phase 1 核心功能已交付（M5 通过）**：不与核心功能开发抢资源
2. **Redis 使用场景已明确且稳定**：了解系统中哪些地方使用了 Redis 缓存，降级逻辑需要全面覆盖
3. **有 0.5-1 天工程师可用**：工时极短，但需要对 Redis 调用点有全面了解

#### 工时估算

**1 人天**（含测试）。主要工作量在于梳理所有 Redis 调用点并统一包裹 fallback 逻辑，逻辑本身非常简单（try-except + PostgreSQL 直查回退）。

#### 依赖关系

```
Redis 缓存失效降级（L3 弹性）
├── 硬依赖
│   └── 无——Redis 降级逻辑独立于其他功能模块
├── 软依赖
│   ├── L0-L2 弹性策略已上线——在已有弹性框架上扩展更自然
│   └── Redis 使用场景稳定——避免降级逻辑与 Redis 调用点频繁变动冲突
└── 被依赖方
    ├── Phase 2+ 多实例部署——多实例环境下 Redis 故障概率上升，降级逻辑价值倍增
    └── 生产环境高可用——SLA 承诺的基础组件之一
```

---

## 推迟功能之间的依赖图（全局视角）

```
Phase 1 余量 / Phase 2 初期
┌──────────────┐
│  S5: Redis   │  （独立，无硬性依赖）
│  缓存降级    │
└──────────────┘

Phase 2
┌──────────────┐     ┌──────────────┐
│  W5: 周期性  │     │  W6: Neo4j   │
│  采集框架    │     │  知识图谱    │
└──────┬───────┘     └──────┬───────┘
       │                     │
       │ F22/F23 验证        │ F25 验证
       │ + S2 Skill 调度     │ + W1 关系逻辑
       │                     │
Phase 3 后 2 周              │  Phase 4
┌──────────────┐          ┌──┴───────────┐
│  S2: Agent   │──────┬───│  W1: Stage 4 │
│  还债（强制） │      │   │  关系构建    │
└──────┬───────┘      │   └──────┬───────┘
       │              │          │
       │ 验证回归     │          │ 关系数据
       ▼              │          ▼
┌──────────────┐      │   ┌──────────────┐
│  S4: Agent   │      │   │  W2: 治理     │
│  评估基准    │      │   │  工作台       │
└──────────────┘      │   └──────────────┘
                      │
Phase 3 后冲刺        │          Phase 5
┌──────────────┐      │   ┌──────────────┐
│  S1: 前端    │──────┼───│  W3: Agent   │
│  第二批      │ UI框架│   │  对话界面    │
└──────────────┘      │   └──────┬───────┘
                      │          │
                      │ 数据基础 │
                ┌─────▼────────┐ │
                │  W4: 数据    │ │
                │  可视化图表  │ │
                └──────────────┘ │
                                 │
Phase 3 内（如有余量）            │          Phase 4+
┌──────────────┐                 │   ┌──────────────┐
│  S3: 行为    │── 行为数据 ─────┘   │  W7: 水平    │
│  追踪埋点    │                     │  扩展部署    │
└──────────────┘                     └──────────────┘
                                     ↑ L0-L3 全部就位
                                     + 单机性能瓶颈
```

**关键路径**：S2（Agent 还债）→ Phase 4 全部功能。这是唯一的硬性阻塞链——如果 S2 被跳过，Phase 4 无法启动。

**最高 ROI 推迟功能**：S3（行为追踪埋点）和 S5（Redis 降级）——均为 1 人天投入，分别提供产品决策量化数据和系统防御性保障。

**最大风险推迟功能**：S2（Agent 还债）——如果持续推迟，技术债务累积将指数级增长，最终导致 Agent 架构重写。

**R5 新增依赖链**：
- W5（周期性采集）← S2（Agent 还债） + F22/F23（Phase 1 爬虫）：爬虫验证可行性后，需要 Skill 调度能力才能实现自动化采集
- W6（Neo4j 图谱）← W1（Stage 4 关系构建） + F25（Neo4j 最小连接层）：图谱功能与关系构建同步推进，F25 是 Phase 1 的技术预验证
- W7（水平扩展）← L0-L3 弹性策略 + 单机性能瓶颈确认：弹性策略最高层，需低层级策略全部就位后才有意义
- S5（Redis 降级）：独立模块，无硬性依赖，可在任何产能空档插入

---

## 重新纳入决策框架

当团队需要决定是否将某个被推迟功能纳入当前开发周期时，应使用以下决策框架：

### 纳入检查清单

1. **前置依赖是否满足？** 检查上方依赖图中的"硬依赖"是否全部就位
2. **数据量/使用量门槛是否达到？** 部分功能（W1、W4、W6）有明确的数据量前置条件
3. **用户信号是否存在？** 优先纳入有明确用户需求信号的功能，避免"建了没人用"
4. **团队产能是否允许？** 评估当前迭代的剩余产能是否足以吸收新功能的工时
5. **是否影响正在进行的里程碑？** 新纳入的功能不应冲击当前里程碑的时间线
6. **合规与安全风险是否已评估？**（R5 新增）爬虫类功能（W5）需通过安全审查后才可纳入

### 优先级排序建议

如果多个被推迟功能同时满足纳入条件，建议按以下优先级排序：

1. **S2（Agent 还债）**——硬性阻塞 Phase 4，不可再推迟
2. **S3（行为追踪埋点）**——1 人天极低投入，高信息密度回报
3. **S5（Redis 缓存降级）**——1 人天极低投入，高防御价值，独立无依赖可随时插入（R5 新增）
4. **S1（前端第二批）**——直接提升用户体验，dogfooding 反馈的直接回应
5. **S4（Agent 评估基准）**——为 Agent 还债提供验证基线
6. **W5（周期性采集）**——爬虫稳定运行后的自然扩展，Phase 2 核心能力升级（R5 新增）
7. **W1（Stage 4 关系构建）**——AI 管线完整性，Phase 4 洞察引擎的输入
8. **W6（Neo4j 图谱）**——与 W1 同步推进，图数据库是关系构建的存储载体（R5 新增）
9. **W4（数据可视化图表）**——依赖数据积累，通常是后期需求
10. **W2（治理工作台）**——依赖 Phase 4 分析器，自然排在 Phase 4 后期
11. **W3（Agent 对话界面）**——最高前端复杂度，最晚纳入
12. **W7（水平扩展部署）**——需单机性能瓶颈确认 + L0-L3 全部就位，最晚阶段（R5 新增）

---

*本文档与 `02-prd-phase1.md`（v2.0 PRD，经 R5 Delta 评审修订）和 `01-discussion-records/R4-final-voting.md`（R4 投票记录）、`01-discussion-records/R5-delta-review.md`（R5 Delta 评审记录）配合使用。所有推迟决策均可追溯到具体的辩论轮次和投票数据。W5、W6、W7、S5 四项条目基于 R5 Delta 评审中 6 项用户修正的延迟功能决议新增。*
